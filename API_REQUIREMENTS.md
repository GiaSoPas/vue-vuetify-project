# Требования к API для страницы создания заказа

## Общие требования

### Аутентификация
- Все запросы должны содержать JWT токен
- Формат заголовка: `Authorization: Bearer <token>`

### Формат ответа об ошибке
```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Человекочитаемое сообщение об ошибке",
    "details": {} // Дополнительные детали ошибки
  }
}
```

### Коды состояния HTTP
- 200: Успешный запрос
- 201: Успешное создание
- 400: Ошибка валидации
- 401: Не авторизован
- 403: Нет доступа
- 404: Ресурс не найден
- 500: Внутренняя ошибка сервера

## Эндпоинты

### 1. Получение категорий меню

**Метод:** GET  
**URL:** `/api/menu/categories`  
**Параметры:** нет

**Ответ:**
```json
[
  {
    "id": 1,
    "name": "Салаты"
  },
  {
    "id": 2,
    "name": "Супы"
  }
]
```

### 2. Получение блюд меню

**Метод:** GET  
**URL:** `/api/menu/items`  
**Параметры запроса:**
- `categoryId` (опционально): ID категории
- `search` (опционально): Поисковый запрос
- `page` (опционально): Номер страницы
- `limit` (опционально): Количество элементов на странице

**Ответ:**
```json
{
  "items": [
    {
      "id": 1,
      "name": "Цезарь с курицей",
      "description": "Классический салат с куриным филе",
      "price": 590,
      "categoryId": 1,
      "available": true,
      "image": "https://example.com/images/caesar.jpg"
    }
  ],
  "total": 100,
  "page": 1,
  "limit": 20
}
```

### 3. Получение списка столов

**Метод:** GET  
**URL:** `/api/tables`  
**Параметры:** нет

**Ответ:**
```json
[
  {
    "id": 1,
    "name": "Стол 1",
    "status": "available", // available, occupied, reserved
    "capacity": 4
  }
]
```

### 4. Создание заказа

**Метод:** POST  
**URL:** `/api/orders`  
**Тело запроса:**
```json
{
  "tableId": 1,
  "guestCount": 2,
  "customerName": "Иван Иванов",
  "customerPhone": "+79001234567",
  "comment": "Просьба не добавлять лук",
  "items": [
    {
      "menuItemId": 1,
      "quantity": 2
    }
  ]
}
```

**Ответ:**
```json
{
  "id": 1,
  "status": "created",
  "tableId": 1,
  "guestCount": 2,
  "customerName": "Иван Иванов",
  "customerPhone": "+79001234567",
  "comment": "Просьба не добавлять лук",
  "items": [
    {
      "menuItemId": 1,
      "quantity": 2,
      "price": 590,
      "name": "Цезарь с курицей"
    }
  ],
  "total": 1180,
  "serviceCharge": 118,
  "finalTotal": 1298,
  "createdAt": "2024-03-20T15:30:00Z"
}
```

### 5. Получение деталей заказа

**Метод:** GET  
**URL:** `/api/orders/{id}`  
**Параметры пути:**
- `id`: ID заказа

**Ответ:**
```json
{
  "id": 1,
  "status": "created",
  "tableId": 1,
  "guestCount": 2,
  "customerName": "Иван Иванов",
  "customerPhone": "+79001234567",
  "comment": "Просьба не добавлять лук",
  "items": [
    {
      "menuItemId": 1,
      "quantity": 2,
      "price": 590,
      "name": "Цезарь с курицей"
    }
  ],
  "total": 1180,
  "serviceCharge": 118,
  "finalTotal": 1298,
  "createdAt": "2024-03-20T15:30:00Z",
  "updatedAt": "2024-03-20T15:30:00Z"
}
```

## Валидация

### Общие правила
- Все обязательные поля должны быть заполнены
- Все числовые значения должны быть положительными
- Все строки должны быть не пустыми

### Специфические правила

#### Заказ
- `tableId`: Должен существовать и быть доступен
- `guestCount`: Минимум 1, максимум 20
- `customerName`: Минимум 2 символа, максимум 100
- `customerPhone`: Формат +7XXXXXXXXXX
- `items`: Массив не пустой
- `items[].menuItemId`: Должен существовать и быть доступен
- `items[].quantity`: Минимум 1, максимум 99

## Кэширование

### Правила кэширования
- Категории: 1 час
- Меню: 30 минут
- Столы: 5 минут

### Заголовки кэширования
```
Cache-Control: max-age=3600
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"
```

## Безопасность

### Rate Limiting
- 100 запросов в минуту на IP
- 1000 запросов в час на пользователя

### Защита от атак
- Защита от SQL-инъекций
- Защита от XSS
- Валидация всех входных данных
- Экранирование специальных символов

### Логирование
- Все запросы должны логироваться
- Критические операции должны иметь расширенное логирование
- Логи должны содержать:
  - Временную метку
  - IP адрес
  - Метод и URL
  - Статус ответа
  - ID пользователя
  - Время выполнения 